<!DOCTYPE HTML>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no;" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>Take a Picture</title>
    <style type="text/css">
         *{
           font-family: Verdana;
           color: #293BA3;         
       }
       input {
           width: 260px;
           height: 70px;
       }
       body {
           background: url("background.png") no-repeat;
       }
       #actions {
           margin-top: 70px;
       }
        #button, #attraction {
            background:#293BA3; /*#449def;*/
            color: #FFFF00; 
            width:180px;
            height:30px;
            font-size: 12px;
            text-style: bold;
            border-style: none; 
            border-radius: 10px;
            margin-top: 5px;
        }
        #button:hover, #attraction:hover {
            -webkit-box-shadow:0 0 20px #555;
            -moz-box-shadow:0 0 20px #555;
            box-shadow:0 0 20px #555;
        }
     </style>
    <script type="text/javascript" charset="utf-8" src="phonegap-1.1.0.js"></script>
    <script type="text/javascript" charset="utf-8">
      
    var deviceReady = false;

    /**
     * Take picture with camera
     */
    function takePicture() {
        navigator.camera.getPicture(
            function(uri) {
                var img = document.getElementById('camera_image');
                img.style.visibility = "visible";
                img.style.display = "block";
                img.src = uri;
                document.getElementById('camera_status').innerHTML = "Success";
            },
            function(e) {
                console.log("Error getting picture: " + e);
                document.getElementById('camera_status').innerHTML = "Error getting picture.";
            },
            { quality: 50, destinationType: navigator.camera.DestinationType.FILE_URI});
    };

    /**
     * Select picture from library
     */
    function selectPicture() {
        navigator.camera.getPicture(
            function(uri) {
                var img = document.getElementById('camera_image');
                img.style.visibility = "visible";
                img.style.display = "block";
                img.src = uri;
                document.getElementById('camera_status').innerHTML = "Success";
            },
            function(e) {
                console.log("Error getting picture: " + e);
                document.getElementById('camera_status').innerHTML = "Error getting picture.";
            },
            { quality: 50, destinationType: navigator.camera.DestinationType.FILE_URI, sourceType: navigator.camera.PictureSourceType.PHOTOLIBRARY});
    };
    
    /**
     * Upload current picture
     */
    function uploadPicture() {
    	
    	// Get URI of picture to upload
        var img = document.getElementById('camera_image');
        var imageURI = img.src;
        if (!imageURI || (img.style.display == "none")) {
            document.getElementById('camera_status').innerHTML = "Take picture or select picture from library first.";
            return;
        }
        var attr = document.getElementById('attraction');
        if (!attr || (attr.value == "none")) {
            document.getElementById('attr').innerHTML = "Please choose the attraction to describe the picture";
            return;
        }
        
        // Verify server has been entered
        
        server = "http://ec2-23-20-205-81.compute-1.amazonaws.com/upload.php?filename=" + attr.value;
        if (server) {
        	
            // Specify transfer options
            
           var options = new FileUploadOptions();
           options.fileKey="file";   
           options.fileName=imageURI.substr(imageURI.lastIndexOf('/')+attr.value);
           options.mimeType="image/jpeg";
           
           var params = new Object();
           params.value1 = attr.value;
           options.params = params;
           options.chunkedMode = false;

           // Transfer picture to server
           var ft = new FileTransfer();
           ft.upload(imageURI, server, function(r) {
               document.getElementById('camera_status').innerHTML = "Upload successful: "+r.bytesSent+" bytes uploaded.";                    
           }, function(error) {
               document.getElementById('camera_status').innerHTML = "Upload failed: Code = "+error.code;                    
           }, options);
            
           
        }
    }
    </script>

  </head>
 <body onload="init();">
   <!-- Actions -->
   <div id="actions">
       <h3>What would you like to do?</h3>
       <input id="button" type="button" onclick="takePicture();" value="Take Picture" /><br/>
       <input id="button" type="button" onclick="selectPicture();" value="Select Picture from Library" /><br/>
   </div>
   <br/>
   
   <!-- Camera -->
       <div>
               <h3>Here's Your Picture:</h3>
               <b>Status:</b> <span id="camera_status"></span><br/>
       <b>Image:</b> <img style="width:120px;visibility:hidden;display:none;" id="camera_image" src="" /><br/>
        <b>Attraction:</b> 
            <select id="attraction">
                <option> </option>
                <option>Fisherman's Wharf</option>
                <option>Pier39</option>
                <option>Pioneer Park</option>
                <option>Aquarium of the Bay</option>
                <option>Wax Museum At Fisherman's Wharf</option>
                </select> </br>
       <input id="button" type="button" onclick="uploadPicture();" value="Upload Picture" />
       </div>
   
 </body>
</html>