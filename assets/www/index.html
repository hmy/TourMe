<!DOCTYPE HTML>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no;" />
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>Take a Picture</title>
    <style type="text/css">
         *{
           font-family: Verdana;
           color: #293BA3;         
       }
       input {
           width: 260px;
           height: 70px;
       }
       body {
           background: url("background.png") no-repeat;
       }
       #actions {
           margin-top: 70px;
       }
       #button, #city {
           background:#293BA3; /*#449def;*/
           color: #FFFF00; 
           width:180px;
           height:30px;
           font-size: 12px;
           text-style: bold;
           border-style: none; 
           border-radius: 10px;
           margin-top: 5px;
       }
       #button:hover, #city:hover {
           -webkit-box-shadow:0 0 20px #555;
           -moz-box-shadow:0 0 20px #555;
           box-shadow:0 0 20px #555;
       }
     </style>
    <script type="text/javascript" charset="utf-8" src="phonegap-1.1.0.js"></script>
    <script type="text/javascript" charset="utf-8">
      
    var deviceReady = false;

    /**
     * Take picture with camera
     */
    function takePicture() {
        navigator.camera.getPicture(
            function(uri) {
                var img = document.getElementById('camera_image');
                img.style.visibility = "visible";
                img.style.display = "block";
                img.src = uri;
                document.getElementById('camera_status').innerHTML = "Success";
            },
            function(e) {
                console.log("Error getting picture: " + e);
                document.getElementById('camera_status').innerHTML = "Error getting picture.";
            },
            { quality: 50, destinationType: navigator.camera.DestinationType.FILE_URI});
    };

    /**
     * Select picture from library
     */
    function selectPicture() {
        navigator.camera.getPicture(
            function(uri) {
                var img = document.getElementById('camera_image');
                img.style.visibility = "visible";
                img.style.display = "block";
                img.src = uri;
                document.getElementById('camera_status').innerHTML = "Success";
            },
            function(e) {
                console.log("Error getting picture: " + e);
                document.getElementById('camera_status').innerHTML = "Error getting picture.";
            },
            { quality: 50, destinationType: navigator.camera.DestinationType.FILE_URI, sourceType: navigator.camera.PictureSourceType.PHOTOLIBRARY});
    };
    
    /**
     * Upload current picture
     */
    function uploadPicture() {
    	
    	// Get URI of picture to upload
        var img = document.getElementById('camera_image');
        var imageURI = img.src;
        if (!imageURI || (img.style.display == "none")) {
            document.getElementById('camera_status').innerHTML = "Take picture or select picture from library first.";
            return;
        }
        
        // Verify server has been entered
        //window.location.protocol = "http"
        //window.location.host = "ec2-23-20-205-81.compute-1.amazonaws.com"
        //window.location.pathname = "upload.php"
        //server = window.location.protocol + "://" + window.location.host + "/" + window.location.pathname;
        
        server = "http://ec2-23-20-205-81.compute-1.amazonaws.com/upload.php"
        if (server) {
        	
            // Specify transfer options
            var options = new FileUploadOptions();
            options.fileKey="file";
            options.fileName=imageURI.substr(imageURI.lastIndexOf('/')+1);
            options.mimeType="image/jpeg";
            options.chunkedMode = false;

            // Transfer picture to server
            var ft = new FileTransfer();
            ft.upload(imageURI, server, function(r) {
                document.getElementById('camera_status').innerHTML = "Upload successful: "+r.bytesSent+" bytes uploaded.";            	
            }, function(error) {
                document.getElementById('camera_status').innerHTML = "Upload failed: Code = "+error.code;            	
            }, options);
        }
    }
    </script>

  </head>
 <body onload="init();">
   <!-- Actions -->
   <div id="actions">
       <h3>What would you like to do?</h3>
       <input id="button" type="button" onclick="takePicture();" value="Take Picture" /><br/>
       <input id="button" type="button" onclick="selectPicture();" value="Select Picture from Library" /><br/>
   </div>
   <br/>
   
   <!-- Camera -->
       <div>
               <h3>Here's Your Picture:</h3>
               <b>Status:</b> <span id="camera_status"></span><br/>
       <b>Image:</b> <img style="width:120px;visibility:hidden;display:none;" id="camera_image" src="" /><br/>
       <b>Location:</b> 
           <select id="city">
               <option>Fisherman's Wharf</option>
               <option>Pier39</option>
               <option>New York</option>
               <option>Boston</option>
               <option>Moscow</option>
               </select> </br>
       <input id="button" type="button" onclick="uploadPicture();" value="Upload Picture" />
       </div>
   
 </body>
</html>